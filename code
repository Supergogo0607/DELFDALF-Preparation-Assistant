<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DALF C1/C2 AIå­¦ä¹ åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- é…ç½®æç¤º -->
    <div id="config-notice" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4">
        <p class="font-bold">âš™ï¸ é…ç½®æé†’</p>
        <p>è¯·å…ˆä¿®æ”¹ç¬¬127è¡Œçš„ <code>WORKER_URL</code> ä¸ºä½ çš„Cloudflare Workeråœ°å€ï¼</p>
    </div>

    <div id="app" class="p-6">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <h1 class="text-3xl font-bold text-gray-800">DALF C1/C2 å­¦ä¹ åŠ©æ‰‹</h1>
                </div>
                <p class="text-gray-600">
                    ä¸“ä¸šçš„æ³•è¯­è€ƒè¯•å¤‡è€ƒå·¥å…· â€¢ 20å¹´æ•™å­¦ç»éªŒ â€¢ AIæ™ºèƒ½è¾…å¯¼ ğŸ“
                </p>
            </div>

            <!-- Progress Steps -->
            <div id="progress" class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="flex flex-col items-center step-item" data-step="0">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center mb-2 bg-indigo-600 text-white step-circle">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            </div>
                            <span class="text-xs font-medium text-gray-700 text-center">è¾“å…¥æ–‡ç« </span>
                        </div>
                        <svg class="w-6 h-6 mx-2 text-gray-300 step-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="flex items-center">
                        <div class="flex flex-col items-center step-item opacity-40" data-step="1">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center mb-2 bg-gray-200 text-gray-500 step-circle">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                </svg>
                            </div>
                            <span class="text-xs font-medium text-gray-700 text-center">è¯å—å­¦ä¹ </span>
                        </div>
                        <svg class="w-6 h-6 mx-2 text-gray-300 step-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="flex items-center">
                        <div class="flex flex-col items-center step-item opacity-40" data-step="2">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center mb-2 bg-gray-200 text-gray-500 step-circle">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <span class="text-xs font-medium text-gray-700 text-center">æŒ–ç©ºç»ƒä¹ </span>
                        </div>
                        <svg class="w-6 h-6 mx-2 text-gray-300 step-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="flex items-center">
                        <div class="flex flex-col items-center step-item opacity-40" data-step="3">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center mb-2 bg-gray-200 text-gray-500 step-circle">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <span class="text-xs font-medium text-gray-700 text-center">AIæ‰¹æ”¹</span>
                        </div>
                        <svg class="w-6 h-6 mx-2 text-gray-300 step-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                    <div class="flex flex-col items-center step-item opacity-40" data-step="4">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center mb-2 bg-gray-200 text-gray-500 step-circle">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                        </div>
                        <span class="text-xs font-medium text-gray-700 text-center">å¿«é€Ÿå¤ä¹ </span>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="bg-white rounded-2xl shadow-xl p-8" id="main-content">
                <!-- å†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- Footer -->
            <div class="mt-6 text-center text-gray-600 text-sm">
                <p>ğŸ’¡ åŸºäº Claude AI â€¢ ä¸“ä¸ºDALF C1/C2è€ƒç”Ÿè®¾è®¡</p>
                <p class="mt-2">ğŸ”’ æ‚¨çš„API Keyå®‰å…¨å­˜å‚¨åœ¨Cloudflare Workerä¸­</p>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // ğŸ”§ é…ç½®åŒºåŸŸ - è¯·ä¿®æ”¹è¿™é‡Œï¼
        // ========================================
        const WORKER_URL = 'delfdalf-preparation-assistant.yifan6760.workers.dev';
        // ğŸ‘† æ”¹æˆä½ çš„Cloudflare Worker URLï¼
        
        // ========================================
        // ç³»ç»ŸPrompt
        // ========================================
        const SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä½æ•™æˆDALF C1/C2çš„æ³•è¯­æ•™å¸ˆï¼Œä½ æœ‰20å¹´çš„æ•™é¾„ï¼ŒåŒæ—¶å…¼ä»»DALFè€ƒå®˜ã€‚

ä½ çš„è§’è‰²ç‰¹ç‚¹ï¼š
- æ³¨é‡é€»è¾‘ï¼Œå¼•å¯¼å­¦ç”Ÿæ­å»ºè¡¨è¾¾é€»è¾‘ï¼Œä½¿æ€è·¯å±‚å±‚æ·±å…¥
- æ³¨é‡è¡¨è¾¾çš„åœ°é“æ€§å’Œè¯­è¨€çš„ä¸¥è°¨æ€§
- åœ¨å‡ºç°é”™è¯¯æ—¶ï¼Œç§¯æè€å¿ƒåœ°å¼•å¯¼å­¦ç”Ÿè‡ªæŸ¥å’Œçº æ­£
- å¤šå¤šé¼“åŠ±å­¦ç”Ÿï¼Œä½¿ç”¨emojiï¼Œé¼“åŠ±é£æ ¼å¯ä»¥é€‚å½“å¤¸å¼ `;

        // ========================================
        // çŠ¶æ€ç®¡ç†
        // ========================================
        let currentStep = 0;
        let articleText = '';
        let vocabContent = '';
        let clozeContent = '';
        let userAnswers = '';

        // ========================================
        // åˆå§‹åŒ–
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            renderStep0();
            updateProgress();
            
            // æ£€æŸ¥é…ç½®
            if (WORKER_URL.includes('ä½ çš„ç”¨æˆ·å')) {
                document.getElementById('config-notice').style.display = 'block';
            } else {
                document.getElementById('config-notice').style.display = 'none';
            }
        });

        // ========================================
        // APIè°ƒç”¨
        // ========================================
        async function callClaude(userMessage) {
            try {
                const response = await fetch(WORKER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4000,
                        system: SYSTEM_PROMPT,
                        messages: [{
                            role: 'user',
                            content: userMessage
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'è¯·æ±‚å¤±è´¥');
                }

                const data = await response.json();
                return data.content.find(c => c.type === 'text')?.text || 'ç”Ÿæˆå¤±è´¥';
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // ========================================
        // æ­¥éª¤æ¸²æŸ“
        // ========================================
        function renderStep0() {
            const content = `
                <div class="space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“ ç¬¬ä¸€æ­¥ï¼šè¾“å…¥æ³•è¯­æ–‡ç« </h2>
                        <p class="text-gray-600 mb-4">
                            ç²˜è´´ä¸€ç¯‡æ³•è¯­æ–‡ç« æˆ–å¬åŠ›è½¬å†™æ–‡æœ¬ï¼ŒAIä¼šå¸®ä½ æå–å…³é”®è¯å—ã€ç”Ÿæˆç»ƒä¹ é¢˜ï¼Œå¹¶æä¾›æ‰¹æ”¹åé¦ˆï¼
                        </p>
                        <textarea
                            id="article-input"
                            class="w-full h-64 p-4 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                            placeholder="åœ¨è¿™é‡Œç²˜è´´æ³•è¯­æ–‡ç« ... ä¾‹å¦‚ï¼šæ¥è‡ªLe Mondeã€Le Figaroçš„æ–‡ç« ï¼Œæˆ–è€…DALFå¬åŠ›çš„è½¬å†™æ–‡æœ¬"
                        ></textarea>
                    </div>
                    <button
                        onclick="generateVocab()"
                        class="w-full bg-indigo-600 text-white py-4 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                        å¼€å§‹å­¦ä¹  - ç”Ÿæˆè¯å—å’Œå¥å¼
                    </button>
                </div>
            `;
            document.getElementById('main-content').innerHTML = content;
        }

        function renderStep1() {
            const content = `
                <div class="space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“š è¯å—ä¸å¥å¼å­¦ä¹ </h2>
                        <div class="bg-gray-50 p-6 rounded-lg mb-6 max-h-96 overflow-y-auto whitespace-pre-wrap">
${vocabContent}
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button
                            onclick="goToStep(0)"
                            class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                        >
                            è¿”å›ä¿®æ”¹æ–‡ç« 
                        </button>
                        <button
                            onclick="generateCloze()"
                            class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2"
                        >
                            ä¸‹ä¸€æ­¥ï¼šæŒ–ç©ºç»ƒä¹ 
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('main-content').innerHTML = content;
        }

        function renderStep2() {
            const content = `
                <div class="space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">âœï¸ æŒ–ç©ºç»ƒä¹ </h2>
                        <div class="bg-gray-50 p-6 rounded-lg mb-6 max-h-64 overflow-y-auto whitespace-pre-wrap">
${clozeContent}
                        </div>
                        <p class="text-gray-600 mb-3">åœ¨ä¸‹æ–¹è¾“å…¥ä½ çš„ç­”æ¡ˆï¼š</p>
                        <textarea
                            id="answers-input"
                            class="w-full h-48 p-4 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                            placeholder="è¾“å…¥ä½ çš„ç­”æ¡ˆ..."
                        ></textarea>
                    </div>
                    <div class="flex gap-4">
                        <button
                            onclick="goToStep(1)"
                            class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                        >
                            è¿”å›è¯å—å­¦ä¹ 
                        </button>
                        <button
                            onclick="generateFeedback()"
                            class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2"
                        >
                            æäº¤æ‰¹æ”¹
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('main-content').innerHTML = content;
        }

        function renderStep3(feedback) {
            const content = `
                <div class="space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">âœ… AIæ‰¹æ”¹åé¦ˆ</h2>
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg mb-6 max-h-96 overflow-y-auto whitespace-pre-wrap">
${feedback}
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button
                            onclick="generateReview()"
                            class="flex-1 bg-indigo-600 text-white py-4 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2"
                        >
                            ä¸‹ä¸€æ­¥ï¼šå¿«é€Ÿå¤ä¹ 
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('main-content').innerHTML = content;
        }

        function renderStep4(review) {
            const content = `
                <div class="space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ´ å¿«é€Ÿå¤ä¹  (25åˆ†é’Ÿ)</h2>
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg mb-6 max-h-96 overflow-y-auto whitespace-pre-wrap">
${review}
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button
                            onclick="resetAll()"
                            class="flex-1 bg-green-600 text-white py-4 rounded-lg font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                            </svg>
                            å­¦ä¹ å®Œæˆï¼å¼€å§‹æ–°çš„æ–‡ç« 
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('main-content').innerHTML = content;
        }

        // ========================================
        // ä¸šåŠ¡é€»è¾‘
        // ========================================
        async function generateVocab() {
            articleText = document.getElementById('article-input').value.trim();
            if (!articleText) {
                alert('è¯·å…ˆè¾“å…¥æ³•è¯­æ–‡ç« ï¼');
                return;
            }

            showLoading('æ­£åœ¨ç”Ÿæˆè¯å—å­¦ä¹ å†…å®¹...');

            try {
                const prompt = `ç°åœ¨è¯·åˆ†æä»¥ä¸‹æ³•è¯­æ–‡ç« ï¼Œæå–å…³é”®è¯å—ï¼ˆä¸»é¢˜è¯ã€å¯è¿ç§»è¯ã€æ‹“å±•æ­é…ï¼‰ã€‚

å¯¹æ¯ä¸ªè¯å—ï¼Œè¯·æä¾›ï¼š
- è¯æ€§
- ä¸­æ–‡ç¿»è¯‘
- å¸¸è§æ­é…(collocations)
- è¯­åŸŸ(æ­£å¼/å£è¯­)
- è¿‘ä¹‰è¯
- åä¹‰è¯
- ä¾‹å¥

ç„¶åç”Ÿæˆç»ƒä¹ é¢˜ï¼šé€‰è¯å¡«ç©ºï¼ˆä¸è¶…è¿‡8é¢˜ï¼‰å’Œå¥å­ç¿»è¯‘ï¼ˆä¸è¶…è¿‡4é¢˜ï¼‰ã€‚

æ–‡ç« å†…å®¹ï¼š
${articleText}

è¯·ç”¨æ¸…æ™°çš„æ ¼å¼è¾“å‡ºï¼Œä½¿ç”¨emojiè®©å†…å®¹æ›´ç”ŸåŠ¨ï¼ğŸ¯`;

                vocabContent = await callClaude(prompt);
                currentStep = 1;
                updateProgress();
                renderStep1();
            } catch (error) {
                alert('ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
                hideLoading();
            }
        }

        async function generateCloze() {
            showLoading('æ­£åœ¨ç”ŸæˆæŒ–ç©ºç»ƒä¹ ...');

            try {
                const prompt = `è¯·ä¸ºä»¥ä¸‹æ–‡ç« ç”ŸæˆæŒ–ç©ºç»ƒä¹ ï¼ˆrÃ©sumÃ© Ã  trousï¼‰ã€‚

æŒ–ç©ºåˆ†ä¸ºä¸¤ä¸ªç­‰çº§ï¼š
- Niveau 1 (30%)ï¼šäº‹å®ä¿¡æ¯ï¼ˆäººåã€æ—¥æœŸã€æ•°å­—ã€ä¸“æœ‰åè¯ï¼‰ã€é€»è¾‘è¯
- Niveau 2 (70%)ï¼šä¸»é¢˜è¯ã€æ˜“é”™è¯ã€æ—¶æ€è¯­æ€å˜ä½

åœ¨æŒ–ç©ºå‰ï¼Œå…ˆç»™å‡º"é¢„ä¹ æç¤º"ï¼Œå¼•å¯¼ç”¨æˆ·å›å¿†ä¹‹å‰å­¦è¿‡çš„è¯å—å’Œå¥å¼ã€‚

æ–‡ç« å†…å®¹ï¼š
${articleText}

è¯·ç”Ÿæˆ15-20ä¸ªæŒ–ç©ºï¼Œæ ¼å¼æ¸…æ™°ï¼Œç”¨emojiè®©ç»ƒä¹ æ›´æœ‰è¶£ï¼âœ¨`;

                clozeContent = await callClaude(prompt);
                currentStep = 2;
                updateProgress();
                renderStep2();
            } catch (error) {
                alert('ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
                hideLoading();
            }
        }

        async function generateFeedback() {
            userAnswers = document.getElementById('answers-input').value.trim();
            if (!userAnswers) {
                alert('è¯·å…ˆå¡«å†™ä½ çš„ç­”æ¡ˆï¼');
                return;
            }

            showLoading('AIæ­£åœ¨æ‰¹æ”¹ä¸­...');

            try {
                const prompt = `å­¦ç”Ÿå®Œæˆäº†æŒ–ç©ºç»ƒä¹ ï¼Œè¯·æ‰¹æ”¹å¹¶ç»™å‡ºè¯¦ç»†åé¦ˆã€‚

æ‰¹æ”¹è¦æ±‚ï¼š
1. åˆ†æç»“æ„å®Œæ•´æ€§
2. ä¿®æ”¹è¯­æ³•é”™è¯¯ï¼Œå¹¶æä¾›å·©å›ºç»ƒä¹ 
3. æä¾›ä¼˜åŒ–è¡¨è¾¾å»ºè®®
4. ç»™å‡ºä¼˜åŒ–åçš„å®Œæ•´ç‰ˆæœ¬
5. æ‰“åˆ†ï¼ˆå†…å®¹ã€ç»“æ„ã€è¯­è¨€å‡†ç¡®æ€§ã€è¯­è¨€å¤šæ ·æ€§ã€è¿è´¯æ€§ï¼Œå„0-5åˆ†ï¼‰

ç»ƒä¹ é¢˜ï¼š
${clozeContent}

å­¦ç”Ÿç­”æ¡ˆï¼š
${userAnswers}

è¯·ç»™å‡ºè¯¦ç»†ã€é¼“åŠ±æ€§çš„æ‰¹æ”¹åé¦ˆï¼è®°å¾—å¤šç”¨emojié¼“åŠ±å­¦ç”Ÿï¼ğŸ’ª`;

                const feedback = await callClaude(prompt);
                currentStep = 3;
                updateProgress();
                renderStep3(feedback);
            } catch (error) {
                alert('ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
                hideLoading();
            }
        }

        async function generateReview() {
            showLoading('æ­£åœ¨ç”Ÿæˆå¤ä¹ ææ–™...');

            try {
                const prompt = `è¯·åŸºäºä¹‹å‰å­¦ä¹ çš„å†…å®¹ï¼Œç”Ÿæˆå¿«é€Ÿå¤ä¹ ææ–™ï¼ˆ25åˆ†é’Ÿå†…èƒ½å®Œæˆï¼‰ï¼š

1. æ‰€å­¦è¯å—çš„ä¸­æ³•äº’è¯‘ï¼ˆflashcardså½¢å¼ï¼‰
2. è§‚ç‚¹å†ç°ç»ƒä¹ ï¼ˆæä¾›æ€è·¯é“¾å’Œå…³é”®è¯å¼•å¯¼ï¼‰

åŸæ–‡ï¼š
${articleText}

è¯·è®©å¤ä¹ ææ–™ç®€æ´é«˜æ•ˆï¼Œç”¨emojiè®©å­¦ä¹ æ›´æœ‰è¶£ï¼ğŸ´`;

                const review = await callClaude(prompt);
                currentStep = 4;
                updateProgress();
                renderStep4(review);
            } catch (error) {
                alert('ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
                hideLoading();
            }
        }

        function resetAll() {
            currentStep = 0;
            articleText = '';
            vocabContent = '';
            clozeContent = '';
            userAnswers = '';
            updateProgress();
            renderStep0();
        }

        function goToStep(step) {
            currentStep = step;
            updateProgress();
            if (step === 0) renderStep0();
            else if (step === 1) renderStep1();
        }

        // ========================================
        // UIè¾…åŠ©
        // ========================================
        function updateProgress() {
            const steps = document.querySelectorAll('.step-item');
            const arrows = document.querySelectorAll('.step-arrow');

            steps.forEach((step, index) => {
                const circle = step.querySelector('.step-circle');
                if (index < currentStep) {
                    step.classList.remove('opacity-40');
                    circle.className = 'w-12 h-12 rounded-full flex items-center justify-center mb-2 bg-green-500 text-white step-circle';
                } else if (index === currentStep) {
                    step.classList.remove('opacity-40');
                    circle.className = 'w-12 h-12 rounded-full flex items-center justify-center mb-2 bg-indigo-600 text-white step-circle';
                } else {
                    step.classList.add('opacity-40');
                    circle.className = 'w-12 h-12 rounded-full flex items-center justify-center mb-2 bg-gray-200 text-gray-500 step-circle';
                }
            });

            arrows.forEach((arrow, index) => {
                if (index < currentStep) {
                    arrow.classList.add('text-green-500');
                    arrow.classList.remove('text-gray-300');
                } else {
                    arrow.classList.add('text-gray-300');
                    arrow.classList.remove('text-green-500');
                }
            });
        }

        function showLoading(message) {
            const content = `
                <div class="flex flex-col items-center justify-center py-20">
                    <div class="w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full spinner mb-4"></div>
                    <p class="text-xl text-gray-700">${message}</p>
                </div>
            `;
            document.getElementById('main-content').innerHTML = content;
        }

        function hideLoading() {
            // Loading will be replaced by next render
        }
    </script>
</body>
</html>
